# AI 模块代码结构说明

## 📁 目录结构

```
ai/
├── core/                          # 【核心代码目录】
│   ├── __init__.py
│   │
│   ├── api/                       # 【API 接口层】- 与 Spring Boot 对接
│   │   ├── __init__.py
│   │   └── routes.py              # Flask 路由定义
│   │
│   ├── services/                  # 【业务服务层】- 核心处理逻辑
│   │   ├── __init__.py
│   │   ├── task_processor.py     # 任务处理器（统筹流程）
│   │   ├── video_processor.py    # 视频处理模块 ⚠️ TODO
│   │   └── mindmap_generator.py  # 思维导图生成模块 ⚠️ TODO
│   │
│   └── utils/                     # 【工具模块】
│       ├── __init__.py
│       ├── response.py            # 统一响应格式
│       ├── callback.py            # Spring Boot 回调工具
│       └── logger.py              # 日志配置
│
├── app.py                         # 【应用入口】Flask 主文件
├── config.py                      # 配置管理（可选）
├── requirements.txt               # Python 依赖
├── .env.example                  # 环境变量示例
│
├── start.bat                      # Windows 启动脚本
├── start.sh                       # Linux/Mac 启动脚本
│
├── uploads/                       # 文件上传目录
├── temp/                          # 临时文件目录
├── logs/                          # 日志目录
│
├── README.md                      # 使用说明
├── CODE-STRUCTURE.md             # 本文件
├── INTEGRATION-GUIDE.md          # 集成指南
└── Dockerfile                     # Docker 部署
```

## 🎯 模块职责

### 1. API 接口层 (`core/api/`)

**职责**: 接收和响应 HTTP 请求

- ✅ `routes.py`: 定义所有 API 路由
  - `POST /api/generate` - 接收 Spring Boot 的任务请求
  - `GET /health` - 健康检查

**特点**:

- 只负责接收请求、验证参数、返回响应
- 不包含业务逻辑
- 与 Spring Boot 对接的入口

### 2. 业务服务层 (`core/services/`)

**职责**: 核心业务逻辑处理

#### 2.1 `task_processor.py` - 任务处理器 ✅

- **已完成**: 统筹整个任务处理流程
- 协调视频处理和思维导图生成
- 处理异常和回调

#### 2.2 `video_processor.py` - 视频处理模块 ⚠️ TODO

**您需要实现**:

```python
✅ 当前: 返回示例数据
⚠️ TODO:
1. 下载视频文件 (_download_video)
2. 提取音频 (_extract_audio)  
3. 语音识别 (_transcribe_audio)
4. 提取字幕 (_extract_subtitles)
5. 关键帧提取（可选）
```

**推荐库**:

- `moviepy` - 视频/音频处理
- `opencv-python` - 视频帧提取
- `whisper` / `speech_recognition` - 语音识别
- `pysrt` - 字幕处理

#### 2.3 `mindmap_generator.py` - 思维导图生成 ⚠️ TODO

**您需要实现**:

```python
✅ 当前: 返回示例 Mermaid 代码
⚠️ TODO:
1. 调用大模型 API (_build_prompt, _parse_response)
2. 分析视频内容结构
3. 生成思维导图节点
4. 转换为 Mermaid 语法
5. 生成视频概要
```

**大模型选择**:

- OpenAI GPT-4 / GPT-3.5
- Anthropic Claude
- 本地部署的 LLaMA/ChatGLM
- 阿里云通义千问
- 讯飞星火

### 3. 工具模块 (`core/utils/`)

**职责**: 提供通用工具函数

- ✅ `response.py`: 统一响应格式
- ✅ `callback.py`: 回调 Spring Boot
- ✅ `logger.py`: 日志配置

## 🔄 处理流程

```
1. Spring Boot 调用
   ↓
2. API 层接收请求 (routes.py)
   ↓
3. 创建任务处理器 (task_processor.py)
   ↓
4. 视频处理 (video_processor.py) ⚠️ TODO
   - 下载视频
   - 提取音频
   - 语音识别
   ↓
5. 生成思维导图 (mindmap_generator.py) ⚠️ TODO
   - 调用大模型
   - 生成 Mermaid 代码
   ↓
6. 回调 Spring Boot (callback.py)
   - 发送处理结果
```
